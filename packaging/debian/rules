#!/usr/bin/make -f

export CARGO_HOME = $(CURDIR)/debian/cargo
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

%:
	dh $@

override_dh_auto_build:
	cargo build --release --locked

override_dh_auto_install:
	# Main binaries
	install -Dm755 target/release/rledger-check debian/rustledger/usr/bin/rledger-check
	install -Dm755 target/release/rledger-format debian/rustledger/usr/bin/rledger-format
	install -Dm755 target/release/rledger-query debian/rustledger/usr/bin/rledger-query
	install -Dm755 target/release/rledger-report debian/rustledger/usr/bin/rledger-report
	install -Dm755 target/release/rledger-doctor debian/rustledger/usr/bin/rledger-doctor
	install -Dm755 target/release/rledger-extract debian/rustledger/usr/bin/rledger-extract
	install -Dm755 target/release/rledger-price debian/rustledger/usr/bin/rledger-price
	# Compatibility binaries
	install -Dm755 target/release/bean-check debian/rustledger/usr/bin/bean-check
	install -Dm755 target/release/bean-format debian/rustledger/usr/bin/bean-format
	install -Dm755 target/release/bean-query debian/rustledger/usr/bin/bean-query
	install -Dm755 target/release/bean-report debian/rustledger/usr/bin/bean-report
	install -Dm755 target/release/bean-doctor debian/rustledger/usr/bin/bean-doctor
	install -Dm755 target/release/bean-extract debian/rustledger/usr/bin/bean-extract
	install -Dm755 target/release/bean-price debian/rustledger/usr/bin/bean-price

override_dh_auto_test:
	cargo test --release

override_dh_auto_clean:
	cargo clean
	rm -rf $(CARGO_HOME)
